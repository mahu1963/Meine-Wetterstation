<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meine Wetterstation</title>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
            background: #f5f5f7;
            margin: 20px;
            color: #333;
        }
        h2 {
            margin-top: 40px;
            color: #111;
        }
        canvas {
            margin-top: 20px;
            background: white;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
    </style>
</head>
<body>

    <h1>üå§Ô∏è Meine Wetterstation</h1>

    <h2>Temperatur ‚Äì Tagesverlauf</h2>
    <canvas id="tempDayChart"></canvas>

    <h2>Temperatur ‚Äì Trend (24h)</h2>
    <canvas id="tempTrendChart"></canvas>

    <h2>Temperatur ‚Äì Woche (Min/Max)</h2>
    <canvas id="tempWeekChart"></canvas>

    <h2>Temperatur ‚Äì Jahr (Min/Max)</h2>
    <canvas id="tempYearChart"></canvas>

    <script>
        // ------------------------------------------------------
        // Regression f√ºr Trendlinie
        // ------------------------------------------------------
        function linearRegression(values) {
            const n = values.length;
            const x = [...Array(n).keys()];
            const y = values;

            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((acc, val, i) => acc + val * y[i], 0);
            const sumXX = x.reduce((acc, val) => acc + val * val, 0);

            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;

            return x.map(i => slope * i + intercept);
        }

        // ------------------------------------------------------
        // Diagramm: Tagesverlauf
        // ------------------------------------------------------
        function drawTempDayChart(data) {
            const ctx = document.getElementById('tempDayChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.hist.map(e => e.time),
                    datasets: [{
                        label: 'Temperatur (¬∞C)',
                        data: data.hist.map(e => e.t),
                        borderColor: 'rgba(255, 80, 80, 1)',
                        backgroundColor: 'rgba(255, 80, 80, 0.2)',
                        tension: 0.3,
                        borderWidth: 2
                    }]
                }
            });
        }

        // ------------------------------------------------------
        // Diagramm: Trendlinie
        // ------------------------------------------------------
        function drawTempTrendChart(data) {
            const ctx = document.getElementById('tempTrendChart').getContext('2d');

            const values = data.hist.map(e => e.t);
            const trend = linearRegression(values);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.hist.map(e => e.time),
                    datasets: [
                        {
                            label: 'Temperatur (¬∞C)',
                            data: values,
                            borderColor: 'rgba(255, 80, 80, 1)',
                            backgroundColor: 'rgba(255, 80, 80, 0.2)',
                            tension: 0.3,
                            borderWidth: 2
                        },
                        {
                            label: 'Trend',
                            data: trend,
                            borderColor: 'rgba(0, 0, 0, 0.8)',
                            borderDash: [6, 6],
                            tension: 0,
                            borderWidth: 2,
                            pointRadius: 0
                        }
                    ]
                }
            });
        }

        // ------------------------------------------------------
        // Diagramm: Woche Min/Max
        // ------------------------------------------------------
        function drawTempWeekChart(data) {
            const ctx = document.getElementById('tempWeekChart').getContext('2d');

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.week.map(e => e.day),
                    datasets: [
                        {
                            label: 'Min (¬∞C)',
                            data: data.week.map(e => e.min),
                            backgroundColor: 'rgba(80, 150, 255, 0.6)'
                        },
                        {
                            label: 'Max (¬∞C)',
                            data: data.week.map(e => e.max),
                            backgroundColor: 'rgba(255, 80, 80, 0.6)'
                        }
                    ]
                }
            });
        }

        // ------------------------------------------------------
        // Diagramm: Jahr Min/Max
        // ------------------------------------------------------
        function drawTempYearChart(data) {
            const ctx = document.getElementById('tempYearChart').getContext('2d');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.year.map(e => e.month),
                    datasets: [
                        {
                            label: 'Min (¬∞C)',
                            data: data.year.map(e => e.min),
                            borderColor: 'rgba(80, 150, 255, 1)',
                            backgroundColor: 'rgba(80, 150, 255, 0.2)',
                            tension: 0.3,
                            borderWidth: 2
                        },
                        {
                            label: 'Max (¬∞C)',
                            data: data.year.map(e => e.max),
                            borderColor: 'rgba(255, 80, 80, 1)',
                            backgroundColor: 'rgba(255, 80, 80, 0.2)',
                            tension: 0.3,
                            borderWidth: 2
                        }
                    ]
                }
            });
        }

        // ------------------------------------------------------
        // JSON laden & Diagramme starten
        // ------------------------------------------------------
        fetch("data.json")
            .then(r => r.json())
            .then(data => {
                drawTempDayChart(data);
                drawTempTrendChart(data);
                drawTempWeekChart(data);
                drawTempYearChart(data);
            });
    </script>

</body>
</html>

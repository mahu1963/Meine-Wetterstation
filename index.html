<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Wetterstation Dashboard</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, Arial;
  background: #0d0d0d;
  color: #fff;
  padding: 20px;
}
canvas {
  width: 100%;
  background: #1a1a1a;
  border-radius: 12px;
  padding: 10px;
}
.hidden { display: none; }
button {
  padding: 8px 14px;
  margin-right: 6px;
  background: #222;
  color: #fff;
  border: 1px solid #444;
  border-radius: 6px;
}
</style>
</head>

<body>
<h1 style="text-align:center;">ðŸŒ¤ Wetterstation</h1>

<div id="livevalues">
  <p id="live-temp"></p>
  <p id="live-hum"></p>
  <p id="live-press"></p>
  <p id="live-trend"></p>
</div>

<div class="tab">
  <button onclick="showTab('24h')">24h</button>
  <button onclick="showTab('week')">Woche</button>
  <button onclick="showTab('month')">Monat</button>
  <button onclick="showTab('year')">Jahr</button>
</div>

<div id="24h"><canvas id="chart24h"></canvas></div>
<div id="week" class="hidden"><canvas id="chartWeek"></canvas></div>
<div id="month" class="hidden"><canvas id="chartMonth"></canvas></div>
<div id="year" class="hidden"><canvas id="chartYear"></canvas></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, get, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "xx",
  authDomain: "meine-wetterstation.firebaseapp.com",
  databaseURL: "https://meine-wetterstation-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "meine-wetterstation",
  storageBucket: "meine-wetterstation.appspot.com",
  messagingSenderId: "593494014586",
  appId: "1:593494014586:web:a05ed68495b1b16d6059c3"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* LIVE-DATEN */
const liveRef = ref(db, "weather/live");
let lastTemp = null;

onValue(liveRef, (snap) => {
  const d = snap.val();
  if (!d) return;

  const t = d.temperature;

  document.getElementById("live-temp").textContent =
    "ðŸŒ¡ Temperatur: " + t.toFixed(1) + " Â°C";

  document.getElementById("live-hum").textContent =
    "ðŸ’§ Luftfeuchtigkeit: " + d.humidity.toFixed(1) + " %";

  document.getElementById("live-press").textContent =
    "ðŸŒ Luftdruck: " + d.pressure.toFixed(1) + " hPa";

  if (lastTemp !== null) {
    if (t > lastTemp) document.getElementById("live-trend").textContent = "ðŸ“ˆ Temperatur steigt";
    else if (t < lastTemp) document.getElementById("live-trend").textContent = "ðŸ“‰ Temperatur fÃ¤llt";
    else document.getElementById("live-trend").textContent = "âž¡ï¸ stabil";
  }
  lastTemp = t;
});

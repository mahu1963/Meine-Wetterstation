<!DOCTYPE html>
<html lang="de">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wetterstation</title>

<style>
  body {
    background: #0d0d0d;
    color: #fff;
    font-family: -apple-system, BlinkMacSystemFont, Arial;
    text-align: center;
    padding: 20px;
  }
  h1 {
    color: #ff5722;
    margin-bottom: 20px;
  }
  .card {
    background: #1a1a1a;
    padding: 18px;
    margin: 12px auto;
    border-radius: 15px;
    width: 90%;
    max-width: 380px;
    box-shadow: 0 0 15px rgba(255, 87, 34, 0.3);
  }
  .label {
    font-size: 1.1em;
    color: #bbb;
  }
  .value {
    font-size: 2.4em;
    font-weight: bold;
    color: #ff7043;
  }
  .trend {
    font-size: 1.4em;
    margin-top: 5px;
  }
  .trend.up { color: #4caf50; }
  .trend.down { color: #f44336; }
  .trend.same { color: #ffc107; }
  .updated {
    margin-top: 15px;
    font-size: 0.9em;
    color: #777;
  }
  #chartContainer {
    margin-top: 25px;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const url = "https://mowesta-12345-default-rtdb.europe-west1.firebasedatabase.app/sensor.json";

let tempHistory = [];
let timeHistory = [];
let chart;

function updateTrend(id, current, previous) {
  const el = document.getElementById(id);
  if (previous === null) {
    el.innerText = "â€“";
    el.className = "trend same";
    return;
  }
  if (current > previous + 0.1) {
    el.innerText = "â†‘ steigend";
    el.className = "trend up";
  } else if (current < previous - 0.1) {
    el.innerText = "â†“ fallend";
    el.className = "trend down";
  } else {
    el.innerText = "â†’ stabil";
    el.className = "trend same";
  }
}

function updateChart() {
  const ctx = document.getElementById("tempChart").getContext("2d");
  if (!chart) {
    chart = new Chart(ctx, {
      type: "line",
      data: {
        labels: timeHistory,
        datasets: [{
          label: "Temperatur (Â°C)",
          data: tempHistory,
          borderColor: "#ff7043",
          backgroundColor: "rgba(255,112,67,0.2)",
          tension: 0.2
        }]
      },
      options: {
        plugins: { legend: { labels: { color: "#fff" } } },
        scales: {
          x: { ticks: { color: "#ccc" } },
          y: { ticks: { color: "#ccc" } }
        }
      }
    });
  } else {
    chart.data.labels = timeHistory;
    chart.data.datasets[0].data = tempHistory;
    chart.update();
  }
}

async function loadData() {
  try {
    const response = await fetch(url);
    const data = await response.json();

    const t = data.temperature;
    const h = data.humidity;
    const p = data.pressure;

    const prevT = parseFloat(localStorage.getItem("prevTemp"));
    const prevH = parseFloat(localStorage.getItem("prevHum"));
    const prevP = parseFloat(localStorage.getItem("prevPress"));

    document.getElementById("temp").innerText = t.toFixed(1) + " Â°C";
    document.getElementById("hum").innerText = h.toFixed(1) + " %";
    document.getElementById("press").innerText = p.toFixed(1) + " hPa";

    updateTrend("tempTrend", t, isNaN(prevT) ? null : prevT);
    updateTrend("humTrend", h, isNaN(prevH) ? null : prevH);
    updateTrend("pressTrend", p, isNaN(prevP) ? null : prevP);

    localStorage.setItem("prevTemp", t);
    localStorage.setItem("prevHum", h);
    localStorage.setItem("prevPress", p);

    const now = new Date();
    const timeLabel = now.toLocaleTimeString();

    tempHistory.push(t);
    timeHistory.push(timeLabel);
    if (tempHistory.length > 20) {
      tempHistory.shift();
      timeHistory.shift();
    }
    updateChart();

    document.getElementById("updated").innerText =
      "Aktualisiert: " + timeLabel;
  } catch (e) {
    document.getElementById("updated").innerText = "Fehler beim Laden";
  }
}

setInterval(loadData, 10000);
window.onload = loadData;
</script>
</head>
<body>

<h1>ðŸ”¥ Wetterstation</h1>

<div class="card">
  <div class="label">Temperatur</div>
  <div class="value" id="temp">-- Â°C</div>
  <div class="trend" id="tempTrend">â€“</div>
</div>

<div class="card">
  <div class="label">Luftfeuchtigkeit</div>
  <div class="value" id="hum">-- %</div>
  <div class="trend" id="humTrend">â€“</div>
</div>

<div class="card">
  <div class="label">Luftdruck</div>
  <div class="value" id="press">-- hPa</div>
  <div class="trend" id="pressTrend">â€“</div>
</div>

<div id="chartContainer" class="card">
  <div class="label">Temperaturverlauf</div>
  <canvas id="tempChart" height="200"></canvas>
</div>

<div class="updated" id="updated">Lade Datenâ€¦</div>

</body>
</html>